# Source server information
$SourceServer = "SourceServerName"
$SourceAppPoolName = "YourAppPoolName"

# Destination server information
$DestinationServer = "DestinationServerName"
$DestinationAppPoolName = "YourAppPoolName" # Use the same name on the destination server

# Copy application pool settings from source to destination
Invoke-Command -ComputerName $DestinationServer -ScriptBlock {
    param($SourceServer, $SourceAppPoolName, $DestinationAppPoolName)

    # Export the application pool configuration on the source server
    Export-WebConfiguration -Name "IIS:\AppPools\$SourceAppPoolName" -PSPath "C:\Temp\$SourceAppPoolName-AppPoolConfig.xml" -Force

    # Import the application pool configuration on the destination server
    Import-WebConfiguration -PSPath "IIS:\AppPools\$DestinationAppPoolName" -Path "C:\Temp\$SourceAppPoolName-AppPoolConfig.xml" -Force

    # Clean up the temporary configuration file
    Remove-Item "C:\Temp\$SourceAppPoolName-AppPoolConfig.xml" -Force
} -ArgumentList $SourceServer, $SourceAppPoolName, $DestinationAppPoolName

# Copy site settings associated with the application pool from source to destination
Invoke-Command -ComputerName $DestinationServer -ScriptBlock {
    param($SourceServer, $SourceAppPoolName, $DestinationAppPoolName)

    # Get the list of sites associated with the source application pool
    $Sites = Get-WebSite | Where-Object { $_.AppPool.Name -eq $SourceAppPoolName }

    foreach ($Site in $Sites) {
        # Export the site configuration on the source server
        Export-WebConfiguration -Name "IIS:\Sites\$($Site.Name)" -PSPath "C:\Temp\$($Site.Name)-SiteConfig.xml" -Force

        # Import the site configuration on the destination server
        Import-WebConfiguration -PSPath "IIS:\Sites\$($Site.Name)" -Path "C:\Temp\$($Site.Name)-SiteConfig.xml" -Force

        # Clean up the temporary configuration file
        Remove-Item "C:\Temp\$($Site.Name)-SiteConfig.xml" -Force
    }
} -ArgumentList $SourceServer, $SourceAppPoolName, $DestinationAppPoolName

Write-Host "Synchronization completed successfully from $SourceServer to $DestinationServer."
