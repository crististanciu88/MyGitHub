# Source server information
$SourceServer = "SourceServerName"
$SourceAppPoolName = "YourAppPoolName"

# Destination server information
$DestinationServer = "DestinationServerName"
$DestinationAppPoolName = "YourAppPoolName" # Use the same name on the destination server

# Path to msdeploy.exe on both servers
$MsDeployPath = "C:\Program Files\IIS\Microsoft Web Deploy V3\msdeploy.exe"

# Create a temporary directory to store the MSDeploy package
$TempDir = Join-Path -Path $env:TEMP -ChildPath (Get-Random)

# Create a Web Deploy package from the source application pool and its sites
& $MsDeployPath -verb:sync -source:appPoolConfig="$SourceAppPoolName" -dest:package="$TempDir\AppPoolAndSites.zip"

# Deploy the package to the destination server
& $MsDeployPath -verb:sync -source:package="$TempDir\AppPoolAndSites.zip" -dest:appPoolConfig="$DestinationAppPoolName" -enableLink:AppPoolExtension

# Clean up the temporary directory
Remove-Item -Path $TempDir -Recurse -Force

Write-Host "Application pool '$SourceAppPoolName' and its associated sites synchronized from $SourceServer to $DestinationServer."
