# Define the name of the application pool you want to export
$AppPoolName = "YourAppPoolName"

# Define the path where you want to save the export
$ExportPath = "C:\Backup\"

# Check if the specified application pool exists
if (Test-Path "IIS:\AppPools\$AppPoolName") {
    # Create a directory for the export if it doesn't exist
    $ExportDirectory = Join-Path -Path $ExportPath -ChildPath $AppPoolName
    if (-not (Test-Path $ExportDirectory -PathType Container)) {
        New-Item -Path $ExportDirectory -ItemType Directory
    }

    # Export the application pool configuration
    Export-WebConfiguration -Name "IIS:\AppPools\$AppPoolName" -PSPath $ExportDirectory -FileName "AppPoolConfig.xml"

    # Get the sites associated with the application pool
    $Sites = Get-WebSite | Where-Object { $_.AppPool.Name -eq $AppPoolName }

    # Export the site configurations
    foreach ($Site in $Sites) {
        Export-WebConfiguration -Name "IIS:\Sites\$($Site.Name)" -PSPath $ExportDirectory -FileName "$($Site.Name)_SiteConfig.xml"
    }

    Write-Host "Export completed successfully. Files saved to $ExportDirectory"
} else {
    Write-Host "Application pool $AppPoolName does not exist."
}
