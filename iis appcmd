param (
    [string]$appPoolName,
    [string]$outputXmlPath
)

# Run appcmd to export the application pool settings to a text file
$appCmdOutputPath = "C:\Path\To\Your\Output.txt"
& C:\Windows\System32\inetsrv\appcmd.exe list apppool "$appPoolName" /text:* > $appCmdOutputPath

# Read the appcmd output and create an XML document
$xmlDoc = New-Object System.Xml.XmlDocument
$xmlRoot = $xmlDoc.CreateElement('AppPoolSettings')
$xmlDoc.AppendChild($xmlRoot)

# Read each line from the appcmd output and create XML elements
Get-Content -Path $appCmdOutputPath | ForEach-Object {
    $property, $value = $_ -split ":", 2
    $sanitizedProperty = $property -replace '[^\w\d_]', ''  # Remove invalid characters
    $xmlProperty = $xmlDoc.CreateElement($sanitizedProperty)
    $xmlProperty.InnerText = $value.Trim()
    $xmlRoot.AppendChild($xmlProperty)
}

# Save the XML to the specified location
$xmlDoc.Save($outputXmlPath)

# Remove the temporary appcmd output file
Remove-Item -Path $appCmdOutputPath -Force

Write-Host "AppPool settings exported to: $outputXmlPath"
