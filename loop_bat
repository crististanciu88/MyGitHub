# List of server names
$servers = @("Server1", "Server2", "Server3")

# Path to the shared drive containing the new binaries
$sharedDrivePath = "\\your\shared\drive\path"

# Name of the app pool
$appPoolName = "YourAppPoolName"

# Loop through each server
foreach ($server in $servers) {
    Write-Host "Processing server: $server"

    # Connect to the remote server
    $session = New-PSSession -ComputerName $server

    # Stop the app pool
    Invoke-Command -Session $session -ScriptBlock {
        Stop-WebAppPool -Name $using:appPoolName
    }

    # Backup existing binaries
    $backupFolder = "$env:SystemDrive\Inetpub\wwwroot\$appPoolName\_Backup$(Get-Date -Format 'yyyyMMddHHmmss')"
    Invoke-Command -Session $session -ScriptBlock {
        Rename-Item -Path "$env:SystemDrive\Inetpub\wwwroot\$using:appPoolName" -NewName $using:backupFolder
    }

    # Copy new binaries from shared drive
    Copy-Item -Path "$sharedDrivePath\$server\*" -Destination "$env:SystemDrive\Inetpub\wwwroot\$appPoolName" -Recurse

    # Start the app pool
    Invoke-Command -Session $session -ScriptBlock {
        Start-WebAppPool -Name $using:appPoolName
    }

    # Disconnect from the remote session
    Remove-PSSession $session

    Write-Host "Completed processing server: $server"
}

Write-Host "Deployment to all servers completed."
