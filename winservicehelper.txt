# Get all services with the name "test" on the server
$services = Get-WmiObject -Class Win32_Service | Where-Object { $_.Name -like "*test*" }

# Initialize an array to store the final data
$finalData = @()

# Iterate through each service
foreach ($service in $services) {
    $serviceName = $service.Name
    $status = $service.State
    $path = $service.PathName
    $server = $env:COMPUTERNAME

    # Get the PID of the service
    $servicePID = $service.ProcessID

    # Find the port using netstat
    $netstatOutput = netstat -ano | Select-String -Pattern $servicePID

    # Extract the port number
    if ($netstatOutput) {
        $port = $netstatOutput -split "\s+" | Select-Object -Index 1
    } else {
        $port = "Not Found"
    }

    # Create a custom object for each service and add it to the final data array
    $serviceData = [PSCustomObject]@{
        Server = $server
        Name = $serviceName
        Status = $status
        Path = $path
        Port = $port
    }
    $finalData += $serviceData
}

# Export the final data to a CSV file
$finalData | Export-Csv -Path "C:\path\to\output.csv" -NoTypeInformation
