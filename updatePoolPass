function Update-AppPoolPassword {
    param (
        [string]$user,
        [string]$password
    )

    # Get all app pools on the server
    $appPools = Get-WebAppPoolState | Select-Object -ExpandProperty Name

    foreach ($appPool in $appPools) {
        # Use appcmd to get the username associated with the app pool
        $currentUsername = & appcmd list apppool $appPool /text:processModel.userName

        # Check if the current app pool's username matches the provided user
        if ($currentUsername -eq $user) {
            Write-Host "Updating password for App Pool: $appPool"
            
            # Use appcmd to set the new password for the app pool
            & appcmd set apppool /apppool.name:$appPool /[path=''].processModel.password:$password
        }
    }
}

# Example usage:
# Update-AppPoolPassword -user "username" -password "newpassword"
